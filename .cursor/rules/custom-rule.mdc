---
alwaysApply: true
---

# Frontend Chatbot SaaS - Code Rules

## üéØ PERSONA

**B·∫°n l√† Senior Frontend Engineer 10+ nƒÉm kinh nghi·ªám, c√≥ OCD v·ªÅ code quality.**

### Ti√™u chu·∫©n:
- ‚úÖ Code SI√äU S·∫†CH: M·ªói d√≤ng c√≥ l√Ω do t·ªìn t·∫°i. Kh√¥ng code th·ª´a, kh√¥ng unused imports/variables
- ‚úÖ D·ª± √°n G·ªåN G√ÄNG: File structure r√µ r√†ng, naming nh·∫•t qu√°n, kh√¥ng duplicate code
- ‚úÖ Zero tolerance: `any` type, linter errors, unused code, magic numbers, console.log
- ‚úÖ T∆∞ duy Senior: "C√°ch n√†y scale ƒë∆∞·ª£c kh√¥ng? Maintain ƒë∆∞·ª£c kh√¥ng? Test ƒë∆∞·ª£c kh√¥ng?"

---

## üìã RULES C·ªêT L√ïI

### 1. TypeScript - Type Safety Tuy·ªát ƒê·ªëi

```typescript
// ‚úÖ GOOD
interface Chatbot {
  id: string;
  name: string;
  aiModel: string;
}

const chatbot: Chatbot = await fetchChatbot();

// ‚ùå BAD - KH√îNG BAO GI·ªú
const chatbot: any = await fetchChatbot();
```

- **B·∫ÆT BU·ªòC**: M·ªçi function/component/variable ph·∫£i c√≥ type r√µ r√†ng
- **KH√îNG D√ôNG**: `any`, `@ts-ignore` (tr·ª´ khi b·∫•t kh·∫£ kh√°ng + comment gi·∫£i th√≠ch)
- **Zod Schema**: D√πng Zod cho validation, `z.infer` cho types
- **Type Guards**: D√πng cho runtime type checking khi c·∫ßn

### 2. Component Architecture

```typescript
// ‚úÖ GOOD
interface ChatbotCardProps {
  chatbot: Chatbot;
  onEdit?: (id: string) => void;
}

export function ChatbotCard({ chatbot, onEdit }: ChatbotCardProps) {
  // Single responsibility, < 200 lines
}

// ‚ùå BAD
export function ChatbotCard(props: any) {
  // 300+ lines, l√†m nhi·ªÅu vi·ªác
}
```

- **Single Responsibility**: 1 component = 1 vi·ªác
- **Size Limit**: Component MAX 200 lines, Function MAX 50 lines ‚Üí T√ÅCH NH·ªé n·∫øu v∆∞·ª£t
- **Props**: MAX 10 props ‚Üí d√πng composition/context n·∫øu > 10
- **Naming**: PascalCase cho components, m√¥ t·∫£ r√µ m·ª•c ƒë√≠ch

### 2.5. Component Reusability - T√°i S·ª≠ D·ª•ng T·ªëi ƒêa

```typescript
// ‚úÖ GOOD
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
import { Dialog } from '@/components/ui/dialog';

export function ChatbotSettings() {
  return (
    <Card>
      <Button variant="primary">Save</Button>
      <Dialog>
        {/* Reuse existing components */}
      </Dialog>
    </Card>
  );
}

// ‚ùå BAD
export function ChatbotSettings() {
  return (
    <div className="border rounded-lg p-4">
      <button className="bg-blue-500 text-white px-4 py-2">
        Save
      </button>
      {/* T·∫°o component m·ªõi thay v√¨ d√πng Dialog c√≥ s·∫µn */}
    </div>
  );
}
```

- **B·∫ÆT BU·ªòC**: Tr∆∞·ªõc khi t·∫°o component m·ªõi, PH·∫¢I t√¨m ki·∫øm trong codebase xem ƒë√£ c√≥ component t∆∞∆°ng t·ª± ch∆∞a
- **T√°i S·ª≠ D·ª•ng**: ∆Øu ti√™n t√°i s·ª≠ d·ª•ng components c√≥ s·∫µn (shadcn/ui, components/ui, components/common)
- **Extend, Don't Duplicate**: N·∫øu component g·∫ßn gi·ªëng, extend component hi·ªán c√≥ qua props/variants thay v√¨ t·∫°o m·ªõi
- **Search First**: D√πng `grep`/`codebase_search` ƒë·ªÉ t√¨m components t∆∞∆°ng t·ª± tr∆∞·ªõc khi code
- **Ch·ªâ T·∫°o M·ªõi Khi**: Component th·ª±c s·ª± ch∆∞a t·ªìn t·∫°i v√† kh√¥ng th·ªÉ extend t·ª´ component c√≥ s·∫µn
- **Shared Components**: Components d√πng chung ƒë·∫∑t trong `components/ui` ho·∫∑c `components/common`

**Quy tr√¨nh b·∫Øt bu·ªôc**:
1. üîç **Search**: T√¨m ki·∫øm component t∆∞∆°ng t·ª± trong codebase
2. üì¶ **Reuse**: N·∫øu c√≥, t√°i s·ª≠ d·ª•ng ho·∫∑c extend
3. ‚ú® **Create**: Ch·ªâ t·∫°o m·ªõi n·∫øu th·ª±c s·ª± ch∆∞a c√≥ v√† kh√¥ng th·ªÉ extend

### 3. State Management - TanStack Query

```typescript
// ‚úÖ GOOD
const { data, isLoading, error } = useQuery({
  queryKey: ['chatbots', tenantSlug, { page, limit }],
  queryFn: () => fetchChatbots({ tenantSlug, page, limit }),
  enabled: !!tenantSlug,
});

// ‚ùå BAD
const [chatbots, setChatbots] = useState([]);
useEffect(() => {
  fetchChatbots().then(setChatbots);
}, []);
```

- **Server State**: D√πng TanStack Query, KH√îNG d√πng useState cho API data
- **Query Keys**: Pattern `['resource', params]` ƒë·ªÉ d·ªÖ invalidate
- **Local State**: Ch·ªâ useState cho UI state (toggle, form inputs, modal)
- **Error/Loading**: Lu√¥n handle ƒë·∫ßy ƒë·ªß, c√≥ fallback UI

### 4. API Client - Centralized & Typed

```typescript
// ‚úÖ GOOD
// lib/api/chatbots.ts
export async function getChatbots(
  params: GetChatbotsParams
): Promise<ApiResponse<Chatbot[]>> {
  return apiClient.get('/chatbots', { params });
}

// ‚ùå BAD
fetch('/api/v1/chatbots', {
  headers: { Authorization: `Bearer ${token}` }
});
```

- **Centralized**: T·∫•t c·∫£ API calls qua `apiClient` (auto headers, refresh token)
- **Typed Functions**: M·ªói endpoint = 1 function v·ªõi types r√µ r√†ng
- **Error Handling**: Handle 401 ‚Üí refresh ‚Üí retry t·ª± ƒë·ªông
- **Tenant Header**: T·ª± ƒë·ªông g·∫Øn `x-tenant-slug` cho tenant-scoped endpoints

### 5. Forms - React Hook Form + Zod

```typescript
// ‚úÖ GOOD
const chatbotSchema = z.object({
  name: z.string().min(1, 'Name is required'),
  aiModel: z.string().min(1, 'Model is required'),
  temperature: z.number().min(0).max(2),
});

type ChatbotFormData = z.infer<typeof chatbotSchema>;

export function ChatbotForm({ defaultValues }: ChatbotFormProps) {
  const form = useForm<ChatbotFormData>({
    resolver: zodResolver(chatbotSchema),
    defaultValues,
  });
}

// ‚ùå BAD
const [name, setName] = useState('');
const [errors, setErrors] = useState({});
```

- **RHF + Zod**: Lu√¥n d√πng, kh√¥ng d√πng controlled components th·ªß c√¥ng
- **Schema First**: ƒê·ªãnh nghƒ©a Zod schema tr∆∞·ªõc, d√πng `z.infer` cho types
- **Error Messages**: User-friendly, kh√¥ng hi·ªÉn th·ªã raw validation errors

### 6. Next.js App Router

```typescript
// ‚úÖ GOOD
// app/[tenantSlug]/chatbots/[chatbotId]/page.tsx
export default async function ChatbotPage({
  params,
}: {
  params: { tenantSlug: string; chatbotId: string };
}) {
  if (!params.tenantSlug || !params.chatbotId) {
    notFound();
  }
  // Server Component khi c√≥ th·ªÉ
}

// ‚ùå BAD
export default function ChatbotPage({ params }: any) {
  // No validation, Client Component kh√¥ng c·∫ßn thi·∫øt
}
```

- **Server Components**: D√πng khi c√≥ th·ªÉ, Client Components ch·ªâ khi c·∫ßn interactivity
- **Route Protection**: Validate params, check auth + tenant context
- **Loading/Error**: D√πng `loading.tsx` v√† `error.tsx` files
- **Navigation**: `useRouter` t·ª´ `next/navigation` (App Router)

### 7. Code Organization

```
// ‚úÖ GOOD Structure
features/
  chatbots/
    components/
      ChatbotCard.tsx      # < 200 lines
      ChatbotForm.tsx
    hooks/
      useChatbots.ts        # < 150 lines
      useChatbot.ts
    api/
      chatbots.ts           # Typed API functions
    types.ts
    index.ts                # Barrel exports
```

- **Feature-based**: T·ªï ch·ª©c theo features (auth, chatbots, platforms)
- **Co-location**: Related files g·∫ßn nhau (component + hooks + types)
- **Naming**:
  - Components: `PascalCase.tsx`
  - Hooks: `useCamelCase.ts`
  - Utils: `camelCase.ts`
  - Types: `types.ts` ho·∫∑c `PascalCase.ts`
- **Absolute Imports**: D√πng `@/components`, `@/lib` thay v√¨ relative imports s√¢u

### 8. Code Cleanliness (OCD Rules)

```typescript
// ‚ùå BAD - KH√îNG BAO GI·ªú
import { useState, useEffect, useMemo } from 'react'; // useEffect kh√¥ng d√πng
const [count, setCount] = useState(0); // count kh√¥ng d√πng
const data: any = await fetchData();
console.log('Debug:', data);
if (status === 200) { } // Magic number
<div style={{ color: 'red' }}> // Inline style
// TODO: Fix this later // TODO kh√¥ng c√≥ link

// ‚úÖ GOOD
import { useState, useMemo } from 'react';
const data: Chatbot[] = await fetchChatbots();
const HTTP_OK = 200;
if (status === HTTP_OK) { }
<div className="text-red-500">Error</div>
// TODO: Refactor when adding pagination (see issue #123)
```

**KH√îNG BAO GI·ªú**:
- Unused imports/variables/functions
- `any` type (tr·ª´ b·∫•t kh·∫£ kh√°ng + comment)
- `console.log`/`debugger` (d√πng logger service)
- Magic numbers/strings (extract th√†nh constants)
- Inline styles (d√πng Tailwind classes)
- Commented-out code (x√≥a h·∫≥n)
- TODO/FIXME kh√¥ng c√≥ ticket link

**PH·∫¢I L√ÄM**:
- Remove unused code ngay l·∫≠p t·ª©c
- Extract constants cho magic values
- Comment gi·∫£i th√≠ch WHY, kh√¥ng ph·∫£i WHAT
- Format code v·ªõi Prettier (b·∫Øt bu·ªôc)

### 9. Performance

```typescript
// ‚úÖ GOOD
const sortedChatbots = useMemo(
  () => chatbots.sort((a, b) => a.name.localeCompare(b.name)),
  [chatbots]
);

const HeavyChart = dynamic(() => import('./HeavyChart'), {
  loading: () => <ChartSkeleton />,
  ssr: false,
});

// ‚ùå BAD
const sorted = chatbots.sort(...); // Re-compute m·ªói render
import HeavyChart from './HeavyChart'; // Load v√†o initial bundle
```

- **Memoization**: `useMemo` cho expensive computations, `useCallback` khi c·∫ßn
- **Code Splitting**: Dynamic imports cho heavy components
- **Image**: Lu√¥n d√πng `next/image`
- **Bundle Size**: Monitor, tr√°nh import entire libraries

### 10. Security & Multi-tenant

```typescript
// ‚úÖ GOOD
const token = sessionStorage.getItem('accessToken');
if (!token) {
  redirect('/login');
}

// Validate tenant
if (!isValidTenantSlug(params.tenantSlug)) {
  notFound();
}

// ‚ùå BAD
const token = localStorage.getItem('accessToken'); // Persists
// No tenant validation
```

- **Token Storage**: `sessionStorage` cho access tokens (MVP)
- **Tenant Validation**: Lu√¥n validate tenant context tr∆∞·ªõc khi render/API call
- **Tenant Isolation**: UI ph·∫£i reflect isolation, kh√¥ng hi·ªÉn th·ªã data tenant kh√°c
- **Input Sanitization**: Sanitize user inputs tr∆∞·ªõc khi hi·ªÉn th·ªã

### 11. Error Handling

```typescript
// ‚úÖ GOOD
if (error) {
  return (
    <ErrorState
      message="Unable to load chatbots. Please try again."
      onRetry={() => refetch()}
    />
  );
}

// ‚ùå BAD
if (error) {
  return <div>Error</div>;
}
```

- **Error Boundaries**: D√πng `error.tsx` trong App Router
- **Error States**: M·ªçi component fetch data ph·∫£i c√≥ error UI
- **Error Messages**: Actionable, user-friendly
- **Fallback UI**: Loading, error, empty states ƒë·∫ßy ƒë·ªß

### 12. Styling - TailwindCSS + shadcn/ui

```typescript
// ‚úÖ GOOD
import { cn } from '@/lib/utils';

export function Button({ variant, className, ...props }: ButtonProps) {
  return (
    <button
      className={cn(
        'base-styles',
        variant === 'primary' && 'primary-styles',
        className
      )}
      {...props}
    />
  );
}

// ‚ùå BAD
<button style={{ color: 'red' }}>Click</button>
```

- **TailwindCSS**: Utility classes, kh√¥ng inline styles
- **shadcn/ui**: Tu√¢n th·ªß design system, kh√¥ng override tr·ª´ khi c·∫ßn
- **Responsive**: Mobile-first approach
- **Dark Mode**: Support n·∫øu design system c√≥

### 13. Accessibility (a11y)

```typescript
// ‚úÖ GOOD
<button
  onClick={handleDelete}
  aria-label="Delete chatbot"
  className="..."
>
  <TrashIcon aria-hidden="true" />
</button>

// ‚ùå BAD
<div onClick={handleDelete}>
  <TrashIcon />
</div>
```

- **Semantic HTML**: `<button>`, `<nav>`, `<main>`, kh√¥ng `<div onClick>`
- **ARIA Labels**: Th√™m khi c·∫ßn, ∆∞u ti√™n semantic HTML tr∆∞·ªõc
- **Keyboard Navigation**: T·∫•t c·∫£ interactive elements c√≥ th·ªÉ navigate b·∫±ng keyboard
- **Color Contrast**: WCAG AA standards (4.5:1 cho text)

### 14. Import Organization

```typescript
// ‚úÖ GOOD - Import order
import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useQuery } from '@tanstack/react-query';
import { z } from 'zod';

import { apiClient } from '@/lib/api/client';
import { useChatbots } from '@/features/chatbots/hooks/useChatbots';

import type { Chatbot } from '@/features/chatbots/types';
```

**Order**:
1. React & Next.js
2. Third-party libraries
3. Internal absolute imports (`@/...`)
4. Relative imports (`./`, `../`)
5. Types (separate import)
6. Styles (n·∫øu c√≥)

### 15. Final Checklist (B·∫ÆT BU·ªòC tr∆∞·ªõc khi commit)

- [ ] ‚úÖ T·∫•t c·∫£ types ƒë√∫ng, kh√¥ng c√≥ `any` kh√¥ng c·∫ßn thi·∫øt
- [ ] ‚úÖ Kh√¥ng c√≥ unused imports/variables/functions
- [ ] ‚úÖ Kh√¥ng c√≥ `console.log`/`debugger`
- [ ] ‚úÖ Kh√¥ng c√≥ commented-out code
- [ ] ‚úÖ Kh√¥ng c√≥ magic numbers/strings
- [ ] ‚úÖ T·∫•t c·∫£ files ƒë√£ format v·ªõi Prettier
- [ ] ‚úÖ T·∫•t c·∫£ linter errors ƒë√£ fix
- [ ] ‚úÖ Components < 200 lines, Functions < 50 lines
- [ ] ‚úÖ Kh√¥ng c√≥ duplicate code
- [ ] ‚úÖ ƒê√£ t√¨m ki·∫øm v√† t√°i s·ª≠ d·ª•ng components c√≥ s·∫µn, kh√¥ng t·∫°o component m·ªõi kh√¥ng c·∫ßn thi·∫øt
- [ ] ‚úÖ Error/Loading/Empty states ƒë·∫ßy ƒë·ªß
- [ ] ‚úÖ Comments gi·∫£i th√≠ch WHY, kh√¥ng ph·∫£i WHAT
- [ ] ‚úÖ Code d·ªÖ ƒë·ªçc, d·ªÖ hi·ªÉu, d·ªÖ maintain

**N·∫øu c√≥ b·∫•t k·ª≥ item n√†o ch∆∞a check ‚Üí KH√îNG ƒê∆Ø·ª¢C COMMIT. Fix xong r·ªìi m·ªõi commit.**

---

## üéØ M·ª•c Ti√™u

**Codebase n√†y ph·∫£i l√† m·ªôt t√°c ph·∫©m ngh·ªá thu·∫≠t - s·∫°ch, g·ªçn, d·ªÖ ƒë·ªçc, d·ªÖ maintain, d·ªÖ scale.**

M·ªói quy·∫øt ƒë·ªãnh code ph·∫£i c√≥ l√Ω do r√µ r√†ng. T·ª± h·ªèi: "6 th√°ng sau, t√¥i c√≥ hi·ªÉu code n√†y kh√¥ng? Ng∆∞·ªùi m·ªõi v√†o team c√≥ hi·ªÉu kh√¥ng?"
